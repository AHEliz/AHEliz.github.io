<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Calendario de Votaciones | ARMYPE</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f6f6fb;
  padding: 30px;
}

/* CONTENEDOR GENERAL */
.calendario-layout {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 30px;
  align-items: start;
}

/* ---------- CALENDARIO ---------- */

.calendario {
  background: white;
  padding: 20px;
  border-radius: 12px;
}

.calendario h2 {
  margin-bottom: 15px;
  color: #6a0dad;
}

/* grid 7 columnas */
.grid-calendario {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 10px;
}

.dia,
.fecha {
  padding: 12px;
  text-align: center;
  border-radius: 8px;
}

.dia {
  font-weight: bold;
  background: #ece9f7;
}

/* celdas normales */
.fecha {
  background: #f3f3f9;
  cursor: default;
}

/* fechas con evento */
.fecha.evento {
  background: #6a0dad;
  color: white;
  cursor: pointer;
  position: relative;
}

/* tooltip */
.fecha.evento .tooltip {
  display: none;
  position: absolute;
  bottom: 110%;
  left: 50%;
  transform: translateX(-50%);
  background: #222;
  color: white;
  padding: 8px 10px;
  font-size: 0.8rem;
  border-radius: 6px;
  width: 160px;
  z-index: 10;
}

.fecha.evento:hover .tooltip {
  display: block;
}

/* ---------- URGENCIAS ---------- */

.urgencias {
  background: white;
  padding: 20px;
  border-radius: 12px;
}

.urgencias h3 {
  color: #c2185b;
  margin-bottom: 15px;
}

.urgencia-card {
  background: #fbe9f2;
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 12px;
}

.urgencia-card a {
  text-decoration: none;
  color: #000;
  font-weight: bold;
}

.urgencia-card span {
  display: block;
  font-size: 0.85rem;
  color: #555;
}

/* RESPONSIVE */
@media (max-width: 900px) {
  .calendario-layout {
    grid-template-columns: 1fr;
  }
}

.calendario-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.calendario-header button {
  background: #6a0dad;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 6px 12px;
  cursor: pointer;
  font-size: 16px;
}

.calendario-header button:hover {
  opacity: 0.85;
}


</style>
</head>

<body>

  <!-- T√çTULO DE LA SECCI√ìN -->
  <h1>Calendario de votaciones</h1>
  <p>Fechas importantes y vencimientos üíú</p>

  <!-- CALENDARIO -->
    <div class="calendario">
      <h2>Enero 2026</h2>
      <div class="grid-calendario" id="calendario"></div>
    </div>
  
  <div class="calendario-header">
    <button id="prevMes">‚óÄ</button>
    <h2 id="titulo-mes"></h2>
    <button id="nextMes">‚ñ∂</button>
  </div>

  <div class="grid-calendario" id="calendario"></div>

  <!-- ESTRUCTURA DEL CALENDARIO -->
  <div class="calendario-layout">
  </div>

    <!-- BLOQUE DE URGENTES -->
    <div class="urgencias">
      <h3>‚ö†Ô∏è Pr√≥ximos a vencer</h3>
      <div id="lista-urgentes"></div>
    </div>
  

  <!-- SCRIPTS (SIEMPRE AL FINAL DEL BODY) -->
  <script src="../data/votaciones.js"></script>
  <script src="calendario.js"></script>

<script src="../data/votaciones.js"></script>

<script>
const calendario = document.getElementById("calendario");
const tituloMes = document.getElementById("titulo-mes");
const listaUrgentes = document.getElementById("lista-urgentes");

let fechaBase = new Date(); // MES ACTUAL

const meses = [
  "Enero","Febrero","Marzo","Abril","Mayo","Junio",
  "Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"
];

function renderCalendario(fecha) {
  calendario.innerHTML = "";

  const a√±o = fecha.getFullYear();
  const mes = fecha.getMonth();

  tituloMes.innerText = `${meses[mes]} ${a√±o}`;

  const primerDia = new Date(a√±o, mes, 1).getDay();
  const diasMes = new Date(a√±o, mes + 1, 0).getDate();

  for (let i = 0; i < primerDia; i++) {
    calendario.innerHTML += `<div></div>`;
  }

  for (let dia = 1; dia <= diasMes; dia++) {
    const fechaActual = new Date(a√±o, mes, dia);
    const fechaISO = fechaActual.toISOString().split("T")[0];

    const eventos = votaciones.filter(v => v.fin === fechaISO);

    let tooltipHTML = "";

    eventos.forEach(e => {
      const diff = Math.ceil((new Date(e.fin) - new Date()) / (1000*60*60*24));
      const estado = diff === 0
        ? "üî• √öLTIMO D√çA"
        : diff <= 3
          ? "‚è∞ Por vencer"
          : "üü¢ Activa";

      tooltipHTML += `
        <strong>${e.plataforma}</strong><br>
        ${estado}<br>
        ${e.descripcion}<br><br>
      `;
    });

    calendario.innerHTML += `
      <a href="../voting/index.html"
         class="fecha ${eventos.length ? "evento" : ""}">
        ${dia}
        ${eventos.length ? `<div class="tooltip">${tooltipHTML}</div>` : ""}
      </a>
    `;
  }
}

function renderUrgentesPorMes(fecha) {
  listaUrgentes.innerHTML = "";

  const a√±o = fecha.getFullYear();
  const mes = fecha.getMonth();
  const hoy = new Date();

  const urgentes = votaciones
    .map(v => {
      const fin = new Date(v.fin);
      const diff = Math.ceil((fin - hoy) / (1000*60*60*24));
      return { ...v, diff, fin };
    })
    .filter(v =>
      v.fin.getMonth() === mes &&
      v.fin.getFullYear() === a√±o &&
      v.diff >= 0 &&
      v.diff <= 3
    )
    .sort((a, b) => a.diff - b.diff)
    .slice(0, 3);

  urgentes.forEach(v => {
    const card = document.createElement("div");
    card.className = "urgencia-card";

    card.innerHTML = `
      <a href="../voting/index.html">
        ${v.plataforma}
        <span>
          ${v.diff === 0 ? "üî• √öLTIMO D√çA" : `Vence en ${v.diff} d√≠a${v.diff !== 1 ? "s" : ""}`}
        </span>
        <span>${v.descripcion}</span>
      </a>
    `;

    listaUrgentes.appendChild(card);
  });
}

// BOTONES
document.getElementById("prevMes").onclick = () => {
  fechaBase.setMonth(fechaBase.getMonth() - 1);
  renderCalendario(fechaBase);
  renderUrgentesPorMes(fechaBase);
};

document.getElementById("nextMes").onclick = () => {
  fechaBase.setMonth(fechaBase.getMonth() + 1);
  renderCalendario(fechaBase);
  renderUrgentesPorMes(fechaBase);
};

// INICIAL
renderCalendario(fechaBase);
renderUrgentesPorMes(fechaBase);
</script>


  
</body>

</html>

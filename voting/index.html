<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Votaciones vigentes | ARMY</title>
    <style>
        body {
            font-family: Arial, sans-serif;
           background: #f7f7fb;
          padding: 30px;
        }
    
        h1 {
          text-align: center;
          margin-bottom: 30px;
        }
    
        /* GRID 4 COLUMNAS */
        .grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 20px;
        }
    
        .card {
          position: relative;
          cursor: pointer;
          border-radius: 12px;
          overflow: hidden;
          box-shadow: 0 6px 15px rgba(0,0,0,0.15);
          transition: transform 0.2s;
        }
    
        .card:hover {
          transform: scale(1.03);
        }
    
        .card img {
          width: 100%;
          height: 220px;
          object-fit: cover;
        }
    
        .card-text {
          position: absolute;
          bottom: 0;
          width: 100%;
          background: rgba(0,0,0,0.65);
          color: white;
          padding: 10px;
          text-align: center;
          font-weight: bold;
        }
    
        /* MODAL */
        .modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.85);
          justify-content: center;
          align-items: center;
          z-index: 999;
        }
    
        .modal-content {
          background: white;
          padding: 25px;
          border-radius: 15px;
          max-width: 500px;
          width: 90%;
        }
    
        .modal-content h2 {
          margin-top: 0;
        }
    
        .modal-content a {
          display: inline-block;
          margin-top: 10px;
          color: #6a1b9a;
          font-weight: bold;
          text-decoration: none;
        }
    
        @media (max-width: 900px) {
          .grid {
            grid-template-columns: repeat(2, 1fr);
          }
        }
    
        @media (max-width: 500px) {
          .grid {
            grid-template-columns: 1fr;
          }
        }

        .estado {
          position: absolute;
          top: 10px;
          left: 10px;
          background: #4caf50;
          color: white;
          padding: 5px 10px;
          font-size: 12px;
          border-radius: 20px;
          font-weight: bold;
        }
        
        .por-vencer .estado {
          background: #ff9800;
        }
        
        .vencido .estado {
          background: #d32f2f;
        }
        
        .vencido img {
          filter: grayscale(100%);
          opacity: 0.6;
        }
        
        .vencido {
          cursor: not-allowed;
        }

        .ultimo-dia .estado {
          background: #c62828;
          animation: pulso 1.5s infinite;
        }

        @keyframes pulso {
          0% { transform: scale(1); }
          50% { transform: scale(1.1); }
          100% { transform: scale(1); }
        }


        .filtros {
  text-align: center;
  margin-bottom: 25px;
}

.filtros button {
  margin: 5px;
  padding: 8px 15px;
  border: none;
  border-radius: 20px;
  background: #e0e0e0;
  cursor: pointer;
  font-weight: bold;
}

.filtros button:hover {
  background: #d1c4e9;
}

.filtros button {
  padding: 8px 16px;
  border-radius: 20px;
  border: none;
  background: #e5e5e5;
  cursor: pointer;
  transition: 0.2s;
}

.filtros button.activo {
  background: #7c3aed; /* morado army ðŸ’œ */
  color: white;
  box-shadow: 0 4px 10px rgba(124,58,237,0.4);
}

.buscador {
  text-align: center;
  margin-bottom: 20px;
}

.buscador input {
  width: 60%;
  max-width: 420px;
  padding: 10px 15px;
  border-radius: 25px;
  border: 1px solid #ccc;
  font-size: 14px;
  outline: none;
  transition: 0.2s;
}

.buscador input:focus {
  border-color: #7c3aed;
  box-shadow: 0 0 8px rgba(124,58,237,0.3);
}

@media (max-width: 600px) {
  .buscador input {
    width: 90%;
  }
}

        
        </style>
</head>
<body>

    <h1>Votaciones vigentes</h1>
    <p>
        AquÃ­ encontrarÃ¡s votaciones activas y verificadas para apoyar a BTS.
        Revisa siempre la fecha lÃ­mite ðŸ’œ
    </p>

<div class="buscador">
  <input 
    type="text" 
    id="busqueda" 
    placeholder="ðŸ” Buscar votaciÃ³n por plataforma, ronda o descripciÃ³n..."
  >
</div>

<!-- GRID DE FILTROS -->
<div class="filtros">
  <button onclick="filtrar('todas', this)" class="activo">Todas</button>
  <button onclick="filtrar('activas', this)">Activas</button>
  <button onclick="filtrar('por-vencer', this)">Por vencer</button>
  <button onclick="filtrar('vencido', this)">Vencidas</button>
</div>

    <div class="grid" id="lista-votaciones"></div>


</div>



<script>
function inicioDelDia(fecha) {
  const d = new Date(fecha);
  d.setHours(0, 0, 0, 0);
  return d;
}
</script>
    
<script>
function fechaLocal(fechaISO) {
  const partes = fechaISO.split("-");
  return new Date(
    Number(partes[0]),
    Number(partes[1]) - 1,
    Number(partes[2])
  );
}
</script>


<script>
function aplicarEstados() {
  const hoy = inicioDelDia(new Date());
  const cards = document.querySelectorAll('.card');

  cards.forEach(card => {
    const inicio = fechaLocal(card.dataset.inicio);

    const fin = fechaLocal(card.dataset.fin);
fin.setHours(23, 59, 59);


    const estado = card.querySelector('.estado');

    card.classList.remove('vencido','por-vencer','ultimo-dia','activas');

    const diff = Math.floor((fin - hoy) / (1000 * 60 * 60 * 24));

    if (fin < hoy) {
      card.classList.add('vencido');
      estado.innerText = 'VENCIDO';
      card.onclick = null;

    } else if (diff === 0) {
      card.classList.add('ultimo-dia');
      estado.innerText = 'ðŸš¨ ÃšLTIMO DÃA';

    } else if (diff <= 3) {
      card.classList.add('por-vencer');
      estado.innerText = 'POR VENCER';

    } else if (hoy >= inicio) {
      card.classList.add('activas');
      estado.innerText = 'ACTIVO';

    } else {
      estado.innerText = 'PRÃ“XIMAMENTE';
    }
  });
}

</script>

    <script>
let filtroActivo = "todas";

function aplicarBusquedaYFiltros() {
  const texto = document.getElementById("busqueda").value.toLowerCase();
  const cards = document.querySelectorAll(".card");

  cards.forEach(card => {
    const coincideBusqueda = card.innerText.toLowerCase().includes(texto);
    const coincideFiltro =
      filtroActivo === "todas" || card.classList.contains(filtroActivo);

    card.style.display =
      coincideBusqueda && coincideFiltro ? "block" : "none";
  });
}

function filtrar(estado, boton) {
  filtroActivo = estado;

  document
    .querySelectorAll('.filtros button')
    .forEach(b => b.classList.remove('activo'));

  boton.classList.add('activo');
  aplicarBusquedaYFiltros();
}
</script>


<!-- MODAL -->
<div id="modal" class="modal" onclick="cerrarModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <h2 id="modal-titulo"></h2>
    <p><strong> Fecha final:</strong> <span id="modal-fecha"></span></p>
    <p id="modal-desc"></p>

    <a id="modal-votar" target="_blank">ðŸ”— Ir a votar</a><br>
    <a id="modal-guia" target="_blank"> Ver guÃ­a</a>
  </div>
</div>

    
<script>
  function abrirModal(titulo, fecha, votar, guia, desc) {
    document.getElementById('modal-titulo').innerText = titulo;
    document.getElementById('modal-fecha').innerText = fecha;
    document.getElementById('modal-desc').innerText = desc;
    document.getElementById('modal-votar').href = votar;
    document.getElementById('modal-guia').href = guia;
    document.getElementById('modal').style.display = 'flex';
  }

  function cerrarModal() {
    document.getElementById('modal').style.display = 'none';
  }
</script>


<script src="../data/votaciones.js"></script>

<script>
const contenedor = document.getElementById("lista-votaciones");

votaciones.forEach(v => {
  const card = document.createElement("div");
  card.className = "card";
  card.dataset.inicio = v.inicio;
  card.dataset.fin = v.fin;

  card.innerHTML = `
    <img src="${v.imagen}">
    <div class="card-text">${v.plataforma} (${v.fechaTexto})</div>
    <div class="estado"></div>
  `;

  card.onclick = () => {
    abrirModal(
      v.titulo,
      v.fechaTexto,
      v.linkVotacion,
      v.linkGuia,
      v.descripcion
    );
  };

  contenedor.appendChild(card);
});

aplicarEstados();

document.getElementById("busqueda")
  .addEventListener("keyup", aplicarBusquedaYFiltros);
</script>


</body>
</html>
